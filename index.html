<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabaseUrl = "https://YOUR_PROJECT_URL.supabase.co"; 
  const supabaseKey = "YOUR_ANON_KEY"; 
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);
  
  // ✅ Sign Up Function (Fix added)
  async function signUpUser(email, password) {
    let { data, error } = await supabase.auth.signUp({ email, password });

    if (error) {
      console.error("Sign Up Error:", error.message);
    } else {
      console.log("User Created:", data);

      // ✅ FIX: `data.session.user.id` use kiya
      if (data.session && data.session.user) {
        await supabase.from("users").insert([
          { id: data.session.user.id, email: email, goldbird_coins: 0 }
        ]);
      } else {
        console.log("User needs to verify email before database entry.");
      }
    }
  }

  // ✅ Sign In Function (Thik hai)
  async function signInUser(email, password) {
    let { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) {
      console.error("Login Error:", error.message);
    } else {
      console.log("User Logged In:", data.user);
    }
  }

  // ✅ Mining Function (Final Fix)
  async function mineGoldBird() {
      let { data: userData, error: userError } = await supabase.auth.getUser();
      let user = userData.user;

      if (!user) {
          alert("Please log in first!");
          return;
      }

      let { error } = await supabase
          .from('users')
          .update({ goldbird_coins: supabase.increment(1) })
          .eq('id', user.id);

      if (error) {
          console.error("Mining Error:", error.message);
      } else {
          alert("You mined 1 GoldBird coin!");
      }
  }
</script>

<button onclick="mineGoldBird()">Start Mining</button>
